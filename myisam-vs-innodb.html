<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>martinbrochhaus.com</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="http://martinbrochhaus.com/theme/css/bootstrap.css" rel="stylesheet" media="screen">
    <link href="http://martinbrochhaus.com/theme/css/bootstrap-responsive.css" rel="stylesheet" media="screen">
    <link href="http://martinbrochhaus.com/theme/css/github.css" rel="stylesheet" media="screen">
    <link href="http://martinbrochhaus.com/theme/css/github-numbers.css" rel="stylesheet" media="screen">
    <link href="http://martinbrochhaus.com/theme/css/styles.css" rel="stylesheet" media="screen">

    <link href='http://fonts.googleapis.com/css?family=Bitter:400,700' rel='stylesheet' type='text/css' >
    <link href='http://fonts.googleapis.com/css?family=Cantora+One' rel='stylesheet' type='text/css'>

        <link href="http://martinbrochhaus.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="martinbrochhaus.com Atom Feed" />
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1147761-33']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</head>
<body>
    <div class="miniBio">
        <div class="container">
            <a class="brand" href="/" title="martinbrochhaus.com"><img src="http://martinbrochhaus.com/theme/img/avatar.jpg" /></a>
            <span class="miniBioText">I build software with Python, Django, ReactJS & React-Native. Every day. All day long.</span>
        </div>
    </div>

    <div class="container">
<div class="container">
    <div class="row">
        <div class="span12 articleDetailHeadline">
            <h1>InnoDB vs. MyISAM</h1>
            <h2>MySQL InnoDB vs. MyISAM and the foreign key constraint of death</h2>
        </div>
    </div>
</div>

<div class="container">
    <div class="row articleDetail">
        <div class="span3 articleInfo light">
<p><i class="icon-calendar"></i>&nbsp;Sun 18 March 2012</p>
    <p class="articleTags">
        <i class="icon-tag"></i>&nbsp;tags:
            <a href="http://martinbrochhaus.com/tag/databases.html">databases</a>
            <a href="http://martinbrochhaus.com/tag/mysql.html">mysql</a>
            <a href="http://martinbrochhaus.com/tag/django.html">django</a>
    </p>
        </div>
        <div class="span6 articleDetailContent">
            <p>During the last few months I constantly ran into problems with MySQL which
drove me crazy and I finally decided to use PostgreSQL for all new projects.
Today I figured out what was going on:</p>
<p>On my development machine I have MySQL version 5.1.61 installed. Recent
Webfaction servers however ship with MySQL version 5.5.16. I think, the newer
version creates new tables with the much better engine InnoDB while my older
version defaults to MyISAM.</p>
<p>I was developing a big Django project in a highly agile way during the last
few months and my workflow looked roughly like this:</p>
<ul>
<li>Write tests</li>
<li>Create fixtures</li>
<li>Implement feature</li>
<li>Rebuild database with the new fixtures</li>
<li>Deploy feature at Webfaction</li>
<li>Export local database</li>
<li>Import local database on Webfacion server</li>
</ul>
<p>This means for the last few months my customer and me were testing the app with
testdata only (which looked very close to the real data anyways). However, this
month the app matured enough so that I stopped importing my local database into
the Webfaction server. From now on I would create South migrations and deploy
them as usual.</p>
<p>Yesterday I created a new app within the project. The model of that app had a
foreign key to a model of one of the older apps. I'm sure you already know what
comes now: Because I used to import my local database into the Webfaction
server for many months, all tables had the old MyISAM engine. When I deployed
my latest feature last night and ran the South migrations everything worked
fine but when I tested the app in a browser, I got the foreign key constraint
error or death.</p>
<p>So I imported the server's datbase locally and asked some stupid questions in
the #mysql channel. A friendly user named <code>salle</code> answered within a second
and I learned about a cool SQL command which I never needed before:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">SHOW</span> <span class="k">TABLE</span> <span class="n">STATUS</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>This shows, among many other informatoin, which engine each of your tables has
and at the first glance I could see that the newly created tables that came
with the South migration on the server had a different engine than all the
rest.</p>
<p>Another stupid question later I learned that I can convert the tables to the
other engine by simply executing:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="n">tablename</span><span class="o">&gt;</span> <span class="n">ENGINE</span><span class="o">=&lt;</span><span class="n">engine</span> <span class="k">name</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>So I converted all MyISAM tables into InnoDB tables and all was good. I should
definitely update my local MySQL installation...</p>
        </div>
    </div>
</div>

<div class="container">
    <div class="row comments">
        <div class="span3">&nbsp;</div>
        <div class="span6">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'martinbrochhauscom'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>
</div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="span6">
                    <p><strong>Martin Brochhaus</strong> is the founder of <a href="http://bitmazk.com">Bitmazk Pte. Ltd.</a>. He is doing web development since 1998 and currently he is in love with Python & Django. Almost all of his work can be found on <a href="https://github.com/bitmazk">Github</a>. When he is not writing code, he gives <a href="https://speakerdeck.com/mbrochh">talks</a> or helps organizing <a href="https://pycon.sg">conferences</a>.</p>
                </div>
                <div class="span4">
                        <p><strong>Say hi!</strong></p>
                        <ul class="socialLinks">
                                <li><a href="https://github.com/mbrochh"><span class="symbol">&#xe037;</span> Github</a></li>
                                <li><a href="https://twitter.com/mbrochh"><span class="symbol">&#xe086;</span> Twitter</a></li>
                                <li><a href="https://secure.flickr.com/photos/mbrochh/"><span class="symbol">&#xe029;</span> Flickr</a></li>
                        </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="http://martinbrochhaus.com/theme/js/bootstrap.min.js"></script>
</body>
</html>