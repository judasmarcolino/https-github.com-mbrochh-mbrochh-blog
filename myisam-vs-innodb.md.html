<!DOCTYPE html>
<html lang="en">
<head>
        <title>MySQL InnoDB vs. MyISAM and the foreign key constraint of death</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
        <link href="/" type="application/atom+xml" rel="alternate" title="martinbrochhaus.com ATOM Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/index.html">martinbrochhaus.com </a></h1>
                <nav><ul>
                                                                                <li><a href="/">Archives</a></li>
                                </ul></nav>
        </header><!-- /#banner -->

        <section id="content" class="body">
<article>
        <header> <h1 class="entry-title"><a href="myisam-vs-innodb.md.html"
        rel="bookmark" title="Permalink to MySQL InnoDB vs. MyISAM and the foreign key constraint of death">MySQL InnoDB vs. MyISAM and the foreign key constraint of death</a></h1>  </header>
        <div class="entry-content">
        <footer class="post-info">
        <abbr class="published" title="2012-03-18T00:00:00">
                Sun 18 March 2012
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="/author/martin-brochhaus.html">Martin Brochhaus</a>
        </address>
        <p>In <a href="/category/blog.html">Blog</a>. </p>
<p>tags: <a href="/tag/databases.html">databases</a><a href="/tag/mysql.html">mysql</a><a href="/tag/django.html">django</a></p></p></footer><!-- /.post-info --><!-- /.post-info -->
        <p>During the last few months I constantly ran into problems with MySQL which
drove me crazy and I finally decided to use PostgreSQL for all new projects.
Today I figured out what was going on:</p>
<p>On my development machine I have MySQL version 5.1.61 installed. Recent
Webfaction servers however ship with MySQL version 5.5.16. I think, the newer
version creates new tables with the much better engine InnoDB while my older
version defaults to MyISAM.</p>
<p>I was developing a big Django project in a highly agile way during the last
few months and my workflow looked roughly like this:</p>
<ul>
<li>Write tests</li>
<li>Create fixtures</li>
<li>Implement feature</li>
<li>Rebuild database with the new fixtures</li>
<li>Deploy feature at Webfaction</li>
<li>Export local database</li>
<li>Import local database on Webfacion server</li>
</ul>
<p>This means for the last few months my customer and me were testing the app with
testdata only (which looked very close to the real data anyways). However, this
month the app matured enough so that I stopped importing my local database into
the Webfaction server. From now on I would create South migrations and deploy
them as usual.</p>
<p>Yesterday I created a new app within the project. The model of that app had a
foreign key to a model of one of the older apps. I'm sure you already know what
comes now: Because I used to import my local database into the Webfaction
server for many months, all tables had the old MyISAM engine. When I deployed
my latest feature last night and ran the South migrations everything worked
fine but when I tested the app in a browser, I got the foreign key constraint
error or death.</p>
<p>So I imported the server's datbase locally and asked some stupid questions in
the #mysql channel. A friendly user named <code>salle</code> answered within a second
and I learned about a cool SQL command which I never needed before:</p>
<div class="highlight"><pre><span class="k">SHOW</span> <span class="k">TABLE</span> <span class="n">STATUS</span><span class="p">;</span>
</pre></div>


<p>This shows, among many other informatoin, which engine each of your tables has
and at the first glance I could see that the newly created tables that came
with the South migration on the server had a different engine than all the
rest.</p>
<p>Another stupid question later I learned that I can convert the tables to the
other engine by simply executing:</p>
<div class="highlight"><pre><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="n">tablename</span><span class="o">&gt;</span> <span class="n">ENGINE</span><span class="o">=&lt;</span><span class="n">engine</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>So I converted all MyISAM tables into InnoDB tables and all was good. I should
definitely update my local MySQL installation...</p>
        </div><!-- /.entry-content -->
                <div class="comments">
        <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
               var disqus_identifier = "myisam-vs-innodb.md.html";
               (function() {
               var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
               dsq.src = 'http://martinbrochhauscom.disqus.com/embed.js';
               (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
        </div>
        
</article>
</section>

        <aside id="sidebar">
                <div class="widget">
                        <h2>Categories</h2>
                        <ul>
                                                   <li class="active"><a href="/category/blog.html">Blog</a></li>
                                                </ul>
                </div>
                                <div class="widget social">
                        <h2>Social</h2>
                        <ul>
                            <li><a href="/" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="https://github.com/mbrochh">Github</a></li>
                                                    <li><a href="https://plus.google.com/101162916953876296847/about">Google Plus</a></li>
                                                    <li><a href="https://twitter.com/mbrochh">Twitter</a></li>
                                                    <li><a href="https://facebook.com/mbrochh">Facebook</a></li>
                                                </ul>
                </div><!-- /.social -->
                </aside><!-- /#sidebar -->

        <footer id="footer" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
                </address><!-- /#about -->

                <p>The theme is «notmyidea-cms», a modified version of «notmyidea», the default theme.</p>
        </footer><!-- /#footer -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-1147761-33");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>